<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Account - ProGen AI</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* Additional styles for value prompts */
    .value-wrapper {
      margin-bottom: 0.5rem;
    }
    
    .value-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }
    
    .btn-sm {
      padding: 6px 12px;
      font-size: 14px;
      white-space: nowrap;
    }
    
    .btn-secondary {
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .btn-secondary:hover {
      background: #5a6268;
    }
    
    .btn-secondary:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .text-sm {
      font-size: 0.875rem;
      color: #666;
      margin-bottom: 8px;
    }
    
    .btn-remove {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .btn-remove:hover {
      background: #c82333;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Create Your Account</h1>
      <p class="subtitle">Fill in your details â€“ a unique <strong>Industry Code</strong> will be e-mailed to you.</p>

      <form id="registerForm">
        <!-- Company & Email -->
        <div class="input-group">
          <label for="company">Company Name *</label>
          <input type="text" id="company" placeholder="e.g., Acme Corp" required />
        </div>

        <div class="input-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" placeholder="you@company.com" required />
        </div>

        <!-- Industry -->
        <div class="input-group">
          <label for="industry">Industry *</label>
          <select id="industry" onchange="toggleCustomIndustry()">
            <option value="Retail">Retail</option>
            <option value="Food and Beverage">Food and Beverage</option>
            <option value="E-commerce">E-commerce</option>
            <option value="Beauty">Beauty</option>
            <option value="Others">Others (Please specify)</option>
          </select>
          <input type="text" id="customIndustry" placeholder="Enter your industry"
                 style="display:none; margin-top:8px;" />
        </div>

        <!-- Product -->
        <div class="input-group">
          <label for="productName">Product Name *</label>
          <input type="text" id="productName" placeholder="e.g., Eco-Friendly Bottle" required />
        </div>

        <div class="input-group">
          <label for="requirements">Company Requirements</label>
          <textarea id="requirements" rows="3"
                    placeholder="Branding, tone, target audienceâ€¦"></textarea>
        </div>

        <!-- Value Prompts - FIXED -->
        <div class="input-group">
          <label>Value Prompts (Optional â€“ max 5)</label>
          <p class="text-sm">e.g. "cartoon", "3D render", "minimalist"</p>
          <div id="valuePrompts"></div>
          <button type="button" class="btn-sm btn-secondary" id="addValueBtn">+ Add Value</button>
        </div>

        <!-- Image Specs -->
        <h2>Default Image Specifications</h2>
        <div class="grid-2">
          <div class="input-group">
            <label for="format">Format</label>
            <select id="format">
              <option value="PNG">PNG</option>
              <option value="JPEG">JPEG</option>
              <option value="WEBP">WEBP</option>
            </select>
          </div>
          <div class="input-group">
            <label for="resolution">Resolution</label>
            <select id="resolution">
              <option value="1024x1024">1024 Ã— 1024</option>
              <option value="768x1152">768 Ã— 1152 (Portrait)</option>
              <option value="1152x768">1152 Ã— 768 (Landscape)</option>
            </select>
          </div>
        </div>

        <button type="submit" class="btn-primary btn-block">
          Create Account & Send Code
        </button>
      </form>

      <p class="text-center mt-4"><a href="index.html">Back to Login</a></p>
    </div>
  </div>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  
  <!-- ALL JAVASCRIPT CODE DIRECTLY IN HTML -->
  <script>
    console.log("=== PROGEN AI REGISTER PAGE LOADED ===");

    let valuePromptCount = 0;

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM fully loaded");
      
      // Add click event to the button
      const addButton = document.getElementById('addValueBtn');
      addButton.addEventListener('click', addValuePrompt);
      console.log("Add button event listener attached");
      
      // Initialize form
      updateAddButtonState();
      console.log("Page initialization complete");
    });

    /* ---------- Add Value Prompt Function ---------- */
    function addValuePrompt() {
      console.log("ðŸŽ¯ ADD VALUE BUTTON CLICKED! Current count:", valuePromptCount);
      
      if (valuePromptCount >= 5) {
        alert("Maximum 5 value prompts allowed.");
        return;
      }
      
      valuePromptCount++;
      console.log("New count:", valuePromptCount);

      const container = document.getElementById("valuePrompts");
      const wrapper = document.createElement("div");
      wrapper.className = "value-wrapper";
      wrapper.innerHTML = `
        <div class="grid-2">
          <input type="text" placeholder="e.g. cartoon, 3D render, minimalist..." class="value-input" />
          <button type="button" class="btn-remove" onclick="removeValuePrompt(this)">Remove</button>
        </div>
      `;
      
      container.appendChild(wrapper);
      updateAddButtonState();
      
      // Focus on the new input
      const newInput = wrapper.querySelector('.value-input');
      newInput.focus();
      
      console.log("New value prompt added successfully");
    }

    /* ---------- Remove Value Prompt ---------- */
    function removeValuePrompt(btn) {
      console.log("Removing value prompt");
      btn.closest(".value-wrapper").remove();
      valuePromptCount--;
      updateAddButtonState();
      console.log("Value prompt removed. New count:", valuePromptCount);
    }

    /* ---------- Update Button State ---------- */
    function updateAddButtonState() {
      const addButton = document.getElementById('addValueBtn');
      if (valuePromptCount >= 5) {
        addButton.disabled = true;
        addButton.textContent = 'Maximum 5 values reached';
        console.log("Button disabled - max reached");
      } else {
        addButton.disabled = false;
        addButton.textContent = '+ Add Value';
        console.log("Button enabled");
      }
    }

    /* ---------- Custom Industry ---------- */
    function toggleCustomIndustry() {
      const select = document.getElementById("industry");
      const custom = document.getElementById("customIndustry");
      custom.style.display = select.value === "Others" ? "block" : "none";
      
      if (select.value === "Others") {
        custom.required = true;
      } else {
        custom.required = false;
        custom.value = '';
      }
    }

    /* ---------- Form Submission ---------- */
    document.getElementById("registerForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      console.log("ðŸ“ FORM SUBMITTED");

      // Collect form data
      const company = document.getElementById("company").value.trim();
      const email = document.getElementById("email").value.trim();
      const industrySelect = document.getElementById("industry").value;
      const customIndustry = document.getElementById("customIndustry").value.trim();
      const product = document.getElementById("productName").value.trim();
      const reqs = document.getElementById("requirements").value.trim();

      // Validation
      if (!company || !email || !product) {
        alert("Please fill in all required fields.");
        return;
      }

      const industry = industrySelect === "Others" ? customIndustry : industrySelect;
      if (industrySelect === "Others" && !customIndustry) {
        alert("Please specify your industry.");
        return;
      }

      // Collect value prompts
      const valueInputs = document.querySelectorAll("#valuePrompts .value-input");
      const valuePrompts = Array.from(valueInputs)
                            .map(i => i.value.trim())
                            .filter(v => v);

      const format = document.getElementById("format").value;
      const resolution = document.getElementById("resolution").value;

      // Generate unique code
      const code = "IND" + Math.random().toString(36).substr(2, 9).toUpperCase();

      console.log("Form data collected:", {
        company, email, industry, product, valuePrompts, code
      });

      // Store in localStorage
      const tempUser = {
        company, email, industry, product, requirements: reqs,
        valuePrompts, format, resolution,
        createdAt: new Date().toISOString()
      };
      localStorage.setItem("tempUser", JSON.stringify(tempUser));
      localStorage.setItem("pendingCode", code);

      // For now, just show success message (we'll add EmailJS later)
      alert(`âœ… Account created successfully!\nYour Industry Code: ${code}\nYou can now login with this code.`);
      
      // Redirect to login
      window.location.href = "index.html";
    });

    console.log("All JavaScript functions defined successfully");
  </script>
</body>
</html>
