<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Account - ProGen AI</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .value-wrapper { margin-bottom: .5rem; }
    .value-input { width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; }
    .grid-2 { display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
    .btn-sm { padding:6px 12px; font-size:14px; white-space:nowrap; }
    .btn-secondary { background:#6c757d; color:#fff; border:none; border-radius:4px; cursor:pointer; }
    .btn-secondary:hover { background:#5a6268; }
    .btn-secondary:disabled { background:#ccc; cursor:not-allowed; }
    .text-sm { font-size:.875rem; color:#666; margin-bottom:8px; }
    .btn-remove { background:#dc3545; color:#fff; border:none; border-radius:4px; padding:6px 12px; cursor:pointer; font-size:14px; }
    .btn-remove:hover { background:#c82333; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Create Your Account</h1>
      <p class="subtitle">Fill in your details – a unique <strong>Industry Code</strong> will be e-mailed to you.</p>

      <form id="registerForm">
        <!-- Company & Email -->
        <div class="input-group">
          <label for="company">Company Name *</label>
          <input type="text" id="company" placeholder="e.g., Acme Corp" required />
        </div>

        <div class="input-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" placeholder="you@company.com" required />
        </div>

        <!-- Industry -->
        <div class="input-group">
          <label for="industry">Industry *</label>
          <select id="industry" onchange="toggleCustomIndustry()">
            <option value="Retail">Retail</option>
            <option value="Food and Beverage">Food and Beverage</option>
            <option value="E-commerce">E-commerce</option>
            <option value="Beauty">Beauty</option>
            <option value="Others">Others (Please specify)</option>
          </select>
          <input type="text" id="customIndustry" placeholder="Enter your industry"
                 style="display:none; margin-top:8px;" />
        </div>

        <!-- Product -->
        <div class="input-group">
          <label for="productName">Product Name *</label>
          <input type="text" id="productName" placeholder="e.g., Eco-Friendly Bottle" required />
        </div>

        <div class="input-group">
          <label for="requirements">Company Requirements</label>
          <textarea id="requirements" rows="3" placeholder="Branding, tone, target audience…"></textarea>
        </div>

        <!-- Value Prompts -->
        <div class="input-group">
          <label>Value Prompts (Optional – max 5)</label>
          <p class="text-sm">e.g. "cartoon", "3D render", "minimalist"</p>
          <div id="valuePrompts"></div>
          <button type="button" class="btn-sm btn-secondary" id="addValueBtn">+ Add Value</button>
        </div>

        <!-- Image Specs -->
        <h2>Default Image Specifications</h2>
        <div class="grid-2">
          <div class="input-group">
            <label for="format">Format</label>
            <select id="format">
              <option value="PNG">PNG</option>
              <option value="JPEG">JPEG</option>
              <option value="WEBP">WEBP</option>
            </select>
          </div>
          <div class="input-group">
            <label for="resolution">Resolution</label>
            <select id="resolution">
              <option value="1024x1024">1024 × 1024</option>
              <option value="768x1152">768 × 1152 (Portrait)</option>
              <option value="1152x768">1152 × 768 (Landscape)</option>
            </select>
          </div>
        </div>

        <button type="submit" class="btn-primary btn-block">
          Create Account & Send Code
        </button>
      </form>

      <p class="text-center mt-4"><a href="index.html">Back to Login</a></p>
    </div>
  </div>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

  <!-- ALL JAVASCRIPT BELOW -->
  <script>
    console.log("=== PROGEN AI REGISTER PAGE LOADED ===");
    let valuePromptCount = 0;

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('addValueBtn').addEventListener('click', addValuePrompt);
      updateAddButtonState();
    });

    function addValuePrompt() {
      if (valuePromptCount >= 5) { alert("Maximum 5 value prompts allowed."); return; }
      valuePromptCount++;
      const container = document.getElementById("valuePrompts");
      const wrapper = document.createElement("div");
      wrapper.className = "value-wrapper";
      wrapper.innerHTML = `
        <div class="grid-2">
          <input type="text" placeholder="e.g. cartoon, 3D render..." class="value-input" />
          <button type="button" class="btn-remove" onclick="removeValuePrompt(this)">Remove</button>
        </div>`;
      container.appendChild(wrapper);
      updateAddButtonState();
      wrapper.querySelector('.value-input').focus();
    }

    function removeValuePrompt(btn) {
      btn.closest(".value-wrapper").remove();
      valuePromptCount--;
      updateAddButtonState();
    }

    function updateAddButtonState() {
      const btn = document.getElementById('addValueBtn');
      if (valuePromptCount >= 5) {
        btn.disabled = true;
        btn.textContent = 'Max 5 reached';
      } else {
        btn.disabled = false;
        btn.textContent = '+ Add Value';
      }
    }

    function toggleCustomIndustry() {
      const select = document.getElementById("industry");
      const custom = document.getElementById("customIndustry");
      custom.style.display = select.value === "Others" ? "block" : "none";
      custom.required = select.value === "Others";
    }

    /* ---------- FORM SUBMISSION ---------- */
    document.getElementById("registerForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      // ---- 1. Grab values ----
      const company   = document.getElementById("company").value.trim();
      const email     = document.getElementById("email").value.trim();
      const industrySelect = document.getElementById("industry").value;
      const customIndustry = document.getElementById("customIndustry").value.trim();
      const product   = document.getElementById("productName").value.trim();
      const reqs      = document.getElementById("requirements").value.trim();

      // ---- 2. REQUIRED FIELDS CHECK (fixed!) ----
      if (!company || !email || !product) {
        alert("Please fill all required fields (Company, Email, Product).");
        return;
      }

      // ---- 3. Custom industry ----
      const industry = industrySelect === "Others" ? customIndustry : industrySelect;
      if (industrySelect === "Others" && !customIndustry) {
        alert("Please enter your custom industry.");
        return;
      }

      // ---- 4. Value prompts ----
      const valuePrompts = Array.from(document.querySelectorAll("#valuePrompts .value-input"))
                               .map(i => i.value.trim())
                               .filter(v => v);

      const format     = document.getElementById("format").value;
      const resolution = document.getElementById("resolution").value;

      // ---- 5. Generate code ----
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let code = 'IND';
      for (let i = 0; i < 9; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }

      // ---- 6. Save locally ----
      const userData = { company, email, industry, product, requirements: reqs,
                         valuePrompts, format, resolution,
                         createdAt: new Date().toISOString() };
      localStorage.setItem("tempUser", JSON.stringify(userData));
      localStorage.setItem("pendingCode", code);

      // ---- 7. Prepare EmailJS ----
      const templateParams = { company, email, product, industry, code };
      emailjs.init("04haQDj1VizCiKBn4");   // <-- your public key

      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = "Sending Code...";

      try {
        await emailjs.send("service_1vi3zyz", "template_y5dzqi9", templateParams);
        alert(`Account created!\nYour Code: ${code}\nCheck your email!`);
        window.location.href = "index.html";
      } catch (err) {
        console.error("EmailJS error:", err);
        alert(`Account created, but email failed.\nYour Code: ${code}\nSAVE IT NOW!`);
        window.location.href = "index.html";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Create Account & Send Code";
      }
    });
  </script>
</body>
</html>
